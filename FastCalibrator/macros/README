#####################################
-- Macros for EB Calibration --------
#####################################

1) macros/DrawPrecisionPlot.C  
   
   Input : -> 2 File for Even and Odd L3 output for a defined data sample
           -> evalStat = 1 for statistical precision analysis
           -> inputLoops = number of L3 loops

   Run : root -l macros/DrawPrecisionPlot.C

   Output: -> Plots = stat precision in eta ring no Folded, convergence Plots in 4 eta region 
              evaluate through linear fit
           -> StatPrec.root = has to be used in the comparision with miscalibrated MC in CompareCalibToMCTruth.C

2) macros/CompareCalibToMCTruth.C

   Input : -> 2 File for IC map Truth and RECO for MC production used
           -> Output L3 MC miscalibrated
           -> Precision Plot for the same MC analysis without miscalibration
   
   Run : root -l macros/CompareCalibToMCTruth.C+

   Output : Plot obtained taking into account this equation IC_Truth = IC_RECO * IC_L3 * Scalib_Map
            -> Residual spread IC_L3*Scalib_Map and IC_Truth/IC_RECO 
            -> Statistical Precision with and without miscalibration

3) macros/DrawFoldedPlotsEB.C

   Input : -> 3 File for Even, Odd and full calibration output for a given data sample
           -> evalstat = 1 in order to evaluate stat sprecision

   Run : root -l macros/DrawFoldedPlotsEB.C+

   Output :  -> IC are Normalized with the mean IC of each eta ring skipping dead channels (IC=0) and TT (map defined in the code)
             -> Spread, stat spread and residual spread of the IC by means of gaussian fits in eta ring folding EB+ on EB-
             -> Study of IC mean value and spread vs iphi%20 after Normalization ---> in order to
                study crack effect on <IC> and apply a correction
             -> IC Correction: <IC>(iphi,ieta) = IC(iphi,ieta)*(IC(iphi%20)/<IC(iphi%20)>) -> correction is applied
                between iphi(0,4) for EB+ and iphi(16,20) for EB-
             -> hcmap and hcmap_crack_corrected are the output map
             -> Spread, stat spread and residual spread are re-evaluated for crack corrected map
             
             -> Dump IC Crack Corrected in a output file .txt (iphi , ieta , IC )
 

##########################################
----- Macros for EE Calibration ----------
########################################## 

1) macros/Normalize_IC_EE.cxx

   Input : -> File output of FastCalibratorEE.cpp 

   Run   : -> root -l macros/Normalize_IC_EE.cxx+

   Output :  Macro to Normalize DATA/MC IC Coefficient along one ring skipping xtal near dead channels and TT EE
             Input File Scale Map of a data sample  an this is saved in the same file updating the old scale_map 
             The ring structure of EE is built using macros/eerings.dat from ix and iy variable of each xtal

2) macros/CompareCalibToMCTruth_EE.C
 
   Input : -> 2 File for IC map Truth and RECO for MC production used EE
           -> Output L3 MC miscalibrated EE
           -> Precision Plot for the same MC analysis without miscalibration
   
   Run : root -l macros/CompareCalibToMCTruth.C+

   Output : Plot obtained taking into account this equation IC_Truth = IC_RECO * IC_L3 * Scalib_Map
            -> Residual spread IC_L3*Scalib_Map and IC_Truth/IC_RECO 
            -> Statistical Precision with and without miscalibration


3) macros/Correction_TrackerEffect_EE_MC.cxx

   input : -> Calibration Maps of (Normalized MC IC * IC_RECO)/(IC_Truth) used to extract empiric correction for data
           -> macros/eerings.dat is used to built EE ring geometry 
           -> List of phi structure coordinates (iphi calcolated from ix and iy) for EE+ and EE-
   
   Run : root -l macros/Correction_TrackerEffect_EE_MC.cxx+

   Output : k(correction_factor) = <IC>(inside a given phi structure)/<IC>(outside, in the all endcap)  
            The analysis is independent between EE+ and EE-.
            -> Map IC are plotted before and after correction
            -> Empiric coefficient are printed and used in Correction_TrackerEffect_EE_DATA_dinamic_alpha.cxx 
   
   Note : these coefficient are strictly dependent on the MC production used (WJetsToLnu and DYToLL Fall1 are considered)

4) macros/Correction_TrackerEffect_EE_DATA_dinamic_alpha.cxx

   input : -> Ntupla of data on which apply correction
           -> macros/eerings.dat is used to built EE ring geometry 
           -> List of phi structure coordinates (iphi calcolated from ix and iy) for EE+ and EE- and 
              empiric coefficient for correction that are different
              between noEP and R9 selection applied in the calibration procedure.
   
   Run : root -l macros/Correction_TrackerEffect_EE_DATA_dinamic_alpha.cxx+

   Output : -> maps of IC corrected are added in the original input file under the name
               h_scale_map_corrected_EEM and h_scale_map_corrected_EEP 

5) macros/DrawCalibrationPlotsEE.C

   input : -> Files for full, even and odd calibration analysis on data or MC
           -> evalstat=1 in order to evaluate statistic spread IC
           -> isMC = true stands for MC EE analysis
           -> MCtruthIC_EE.root and MCRecoIC_EE.root are used for MC Analysis
           -> existingEE.root -> contains problematic channel in the Endcap

   Run : root -l macros/DrawCalibrationPlotsEE.C+

   Output: -> Plot for spread, statistical precision and residual spred for EE+, EE- and folding EE+ over EE-
           -> If isMC=true Plots of statistic precision for EE+, EE- and folded are saved in StatPrec_MC_EE.root
              You have to run this code before run CompareCalibToMCTruth_EE.C 
           -> if isMC=true comparison plot MC(Truth/RECO)/MC IC that are saved in IC_MC_4Correction.root 
              This file is used as input in macros/Correction_TrackerEffect_EE_MC.cxx
           -> ifMC=false Calibration_Coefficient_EE_dinamic_alpha.txt that is the txt file of EE IC
           -> Map of warning channel after InterCalibration
